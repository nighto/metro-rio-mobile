<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><!-- forcing IE to use it's new render engine -->

	<title>PAGE-TITLE</title>

	<link rel="stylesheet" href="jquery/jquery-mobile.css" />
	<link rel="stylesheet" href="css/style.css" />
	<link rel="apple-touch-icon" href="img/metro-rio-mobile-touch-icon.png" />
	<link rel="shortcut icon" href="img/favicon.ico" />

	<script src="jquery/jquery.js"></script>  
	<script src="jquery/jquery-mobile.js"></script>

	<script type="text/javascript">

	/* This extend makes me get ?GET variables like ?code=CTT. */
	$.extend({
		getUrlVars: function(){
			var vars = [], hash;
			var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
			for(var i = 0; i < hashes.length; i++) {
				hash = hashes[i].split('=');
				vars.push(hash[0]);
				vars[hash[0]] = hash[1];
			}
			return vars;
		},
		getUrlVar: function(name){
			return $.getUrlVars()[name];
		}
	});

	$(document).ready(function(){ // when the page finished loading
		$.get('metro-rio.xml',function(d){ // get my XML
			$(d).find('station').each(function() { // for each station
				if ($(this).find('code').text() === $.getUrlVar('code')) { // pick the desired station

					/* Reading variables from XML */
					name = $(this).find('name').text();
					code = $(this).find('code').text();
					old_name = $(this).find('old_name').text();
					start_date = $(this).find('start_date').text();
					wheelchair_access = $(this).find('wheelchair_access').text();
					bicycle_parking = $(this).find('bicycle_parking').text();
					bicycle_parking_capacity = $(this).find('bicycle_parking_capacity').text();
					lat = $(this).find('lat').text();
					lon = $(this).find('lon').text();

					/* Populating the page. */
					$('h1').html(name);
					$('title').html(name);
					$('#content').html('');

					if (!(start_date === ''))
						$('#content').append('<p>A estação ' + name + ' foi inaugurada em ' + start_date + '.</p>');

					if (!(old_name === ''))
						$('#content').append('<p>Ela já se chamou ' + old_name + '.</p>');

					if (wheelchair_access === 'yes')
						$('#content').append('<p class="wheelchair yes">A estação segue as diretrizes de acessibilidade.</p>');
					if (wheelchair_access === 'no')
						$('#content').append('<p class="wheelchair no">A estação não segue as diretrizes de acessibilidade.</p>');
					/* Can't use "else" because wheelchair can either not be defined or have a random value. */

					if (bicycle_parking === 'yes') {
						bicycle_parking_capacity_text = '';
						if (!(bicycle_parking_capacity === ''))
							bicycle_parking_capacity_text = ' com ' + bicycle_parking_capacity + ' vagas';
						$('#content').append('<p class="bicycle yes">A estação possui bicicletário' + bicycle_parking_capacity_text + '.</p>');
					}
					if (bicycle_parking === 'no')
						$('#content').append('<p class="bicycle no">A estação não possui bicicletário.</p>');

					if ((!(lat === '')) && (!(lon === ''))) {
						var maps = '<div class=\"ui-grid-a\">';
								maps += '<div class=\"ui-block-a\">';
									maps += '<p class=\"googlemaps\">';
										maps += '<a href=\"http://maps.google.com.br?ie=UTF8?ll=' + lat + ',' + lon + '&z=17">Google Maps</a>';
									maps += '</p>';
								maps += '</div>';
								maps += '<div class="ui-block-b">';
									maps += '<p class="openstreetmap">'
										maps += '<a href="http://www.opentouchmap.org?lat=' + lat + '&lon=' + lon + '&zoom=17">OSM</a>';
									maps +='</p>';
								maps += '</div>';
							maps += '</div>';
						$('#content').append(maps);
					}
				}
			});
		});
	});

	</script>
</head>

<body>
	<div data-role="page" id="PAGE-TITLE">
		<div data-role="header">
			<div class="ui-grid-b">
				<div class="ui-block-a">&nbsp;</div>
				<div class="ui-block-b"><h1>Ops!</h1></div>
				<div class="ui-block-c">&nbsp;</div>
			</div>
		</div><!--/header-->
		
		<div data-role="content" id="content">
			<p id="teste">Estação não encontrada.</p>
		</div><!--/content-->
	</div><!--/page-->
</body>
</html>
